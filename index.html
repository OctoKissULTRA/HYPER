<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HYPERtrends v4.0 - Neural Trading Matrix</title>
    <!-- Chart.js Core -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <!-- Chart.js Financial Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0/dist/chartjs-chart-financial.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Favicon and Branding -->
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <style>
        :root {
            --bg-main: #090909;
            --bg-card: #16171c;
            --neon-cyan: #00fff7;
            --neon-pink: #ff43e9;
            --neon-yellow: #fff800;
            --neon-green: #24ff87;
            --neon-purple: #bf38ff;
            --neon-orange: #ffb03a;
            --neon-red: #ff304c;
            --text-main: #f6f6f6;
            --text-dim: #a2adb8;
            --border: #23242a;
            --gradient-primary: linear-gradient(90deg, #00fff7, #bf38ff 65%, #ff43e9 100%);
            --gradient-buy: linear-gradient(90deg, #24ff87 30%, #00fff7 100%);
            --gradient-sell: linear-gradient(90deg, #ff304c 0%, #ffb03a 100%);
            --shadow: 0 4px 24px #00fff755;
        }
        html, body {
            background: var(--bg-main);
            color: var(--text-main);
            font-family: 'JetBrains Mono', 'Orbitron', monospace;
            margin: 0;
            padding: 0;
            width: 100vw;
            min-height: 100vh;
        }
        body {
            overflow-x: hidden;
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 5vw 18px 5vw;
            background: var(--bg-card);
            border-bottom: 2px solid var(--neon-cyan);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .header .logo-wrap {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .header .logo-img {
            height: 48px;
            filter: drop-shadow(0 0 18px var(--neon-cyan));
        }
        .header .brand-text {
            font-family: 'Orbitron', monospace;
            font-size: 2rem;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 12px var(--neon-cyan);
            letter-spacing: 2px;
        }
        .header .status-dot {
            display: inline-block;
            width: 11px;
            height: 11px;
            background: var(--neon-green);
            border-radius: 50%;
            margin-right: 9px;
            box-shadow: 0 0 10px var(--neon-green);
            vertical-align: middle;
        }
        .header .status-label {
            font-size: 1rem;
            color: var(--text-dim);
        }
        .main-container {
            display: flex;
            flex-direction: column;
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.3rem 2vw 4rem 2vw;
        }
        @media (max-width: 900px) {
            .main-container { padding: 1rem 1vw 3rem 1vw; }
        }
        @media (max-width: 600px) {
            .header { flex-direction: column; gap: 7px; padding: 11px 2vw; }
            .main-container { padding: 0.7rem 0.4vw 2rem 0.4vw; }
            .header .brand-text { font-size: 1.15rem; }
            .header .logo-img { height: 32px; }
        }

        /* Control + chart area grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 2.2rem;
            margin-top: 2rem;
        }
        @media (max-width: 950px) {
            .content-grid { grid-template-columns: 1fr; gap: 2rem; }
        }

        /* Card panels */
        .card {
            background: var(--bg-card);
            border-radius: 19px;
            box-shadow: var(--shadow);
            border: 1.5px solid var(--border);
            padding: 2rem 1.5rem;
            margin-bottom: 2.2rem;
        }
        @media (max-width: 600px) {
            .card { padding: 1.1rem 0.7rem; margin-bottom: 1rem; }
        }

        /* Symbol/timeframe selectors */
        .symbol-grid, .timeframe-grid {
            display: flex;
            gap: 0.7rem;
            flex-wrap: wrap;
        }
        .symbol-btn, .timeframe-btn {
            background: var(--bg-main);
            color: var(--neon-cyan);
            font-family: 'Orbitron', monospace;
            border: 2px solid var(--neon-cyan);
            border-radius: 9px;
            padding: 0.65rem 1.2rem;
            font-size: 1.05rem;
            font-weight: 700;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.18s;
            margin-bottom: 6px;
        }
        .symbol-btn.active, .timeframe-btn.active {
            background: var(--gradient-primary);
            color: #090909;
            box-shadow: 0 2px 12px var(--neon-cyan);
        }
        .symbol-btn:active, .timeframe-btn:active { transform: scale(0.96); }
        @media (max-width: 600px) {
            .symbol-btn, .timeframe-btn { font-size: 0.9rem; padding: 0.5rem 0.9rem; }
        }

        /* Chart area */
        .chart-card {
            min-height: 510px;
            padding-bottom: 1rem;
            position: relative;
        }
        .chart-header {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
            gap: 1.2rem;
        }
        .chart-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.25rem;
            color: var(--neon-cyan);
            font-weight: 900;
            letter-spacing: 1px;
        }
        .price-block {
            text-align: right;
        }
        .current-price {
            font-size: 2.1rem;
            font-weight: 900;
            color: var(--neon-green);
        }
        .price-change {
            font-size: 1.06rem;
            font-weight: 700;
        }
        .price-up { color: var(--neon-green); }
        .price-down { color: var(--neon-red); }
        .chart-container {
            height: 340px;
            margin-bottom: 0.8rem;
        }
        @media (max-width: 600px) {
            .chart-container { height: 210px; }
            .current-price { font-size: 1.25rem; }
        }

        /* Overlays and signals */
        .overlay-marker {
            position: absolute;
            font-size: 1.2rem;
            font-weight: 900;
            pointer-events: none;
        }
        .overlay-buy { color: var(--neon-green); text-shadow: 0 0 7px var(--neon-green);}
        .overlay-sell { color: var(--neon-red); text-shadow: 0 0 7px var(--neon-red);}
        .overlay-confidence {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--neon-cyan);
        }

        /* Analytics area */
        .metrics-grid {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            margin: 1rem 0 0.6rem 0;
        }
        .metric-block {
            flex: 1;
            min-width: 90px;
            background: var(--bg-main);
            border-radius: 9px;
            padding: 0.75rem 0.6rem 0.65rem 0.6rem;
            text-align: center;
        }
        .metric-label {
            font-size: 0.76rem;
            color: var(--text-dim);
            margin-bottom: 0.13rem;
        }
        .metric-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 900;
            color: var(--neon-cyan);
        }

        /* Action buttons for mobile */
        .action-bar {
            position: fixed;
            left: 0; right: 0; bottom: 0;
            background: var(--bg-card);
            border-top: 2px solid var(--neon-cyan);
            box-shadow: 0 -2px 16px #00fff755;
            z-index: 30;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            padding: 0.85rem 0;
        }
        .action-btn {
            flex: 1;
            margin: 0 0.45rem;
            background: var(--gradient-primary);
            color: var(--bg-main);
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 1.07rem;
            border: none;
            border-radius: 11px;
            padding: 0.73rem 0.5rem;
            box-shadow: 0 2px 8px #00fff722;
            transition: all 0.18s;
        }
        .action-btn:active { transform: scale(0.97);}
        @media (min-width: 601px) { .action-bar { display: none; } }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo-wrap">
            <img class="logo-img" src="assets/logo.png" alt="HYPERtrends logo">
            <span class="brand-text">HYPERtrends</span>
        </div>
        <div>
            <span class="status-dot"></span>
            <span class="status-label">NEURAL LINK ACTIVE</span>
        </div>
    </div>
    <div class="main-container">
        <div class="content-grid">
            <!-- Left: Controls -->
            <div>
                <div class="card">
                    <div class="symbol-grid">
                        <button class="symbol-btn active" data-symbol="QQQ">QQQ</button>
                        <button class="symbol-btn" data-symbol="SPY">SPY</button>
                        <button class="symbol-btn" data-symbol="NVDA">NVDA</button>
                        <button class="symbol-btn" data-symbol="AAPL">AAPL</button>
                        <button class="symbol-btn" data-symbol="MSFT">MSFT</button>
                    </div>
                    <div class="timeframe-grid" style="margin-bottom:1.4rem;">
                        <button class="timeframe-btn active" data-interval="15m">15M</button>
                        <button class="timeframe-btn" data-interval="1m">1M</button>
                        <button class="timeframe-btn" data-interval="5m">5M</button>
                        <button class="timeframe-btn" data-interval="1h">1H</button>
                        <button class="timeframe-btn" data-interval="4h">4H</button>
                        <button class="timeframe-btn" data-interval="1d">1D</button>
                    </div>
                </div>
                <div class="card" style="margin-bottom:0.7rem;">
                    <div class="metrics-grid">
                        <div class="metric-block">
                            <div class="metric-label">Volume</div>
                            <div class="metric-value" id="daily-volume">—</div>
                        </div>
                        <div class="metric-block">
                            <div class="metric-label">Market Cap</div>
                            <div class="metric-value" id="market-cap">—</div>
                        </div>
                        <div class="metric-block">
                            <div class="metric-label">Beta</div>
                            <div class="metric-value" id="beta">—</div>
                        </div>
                        <div class="metric-block">
                            <div class="metric-label">Volatility</div>
                            <div class="metric-value" id="volatility">—</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Right: Chart/Signals -->
            <div>
                <div class="card chart-card">
                    <div class="chart-header">
                        <div>
                            <span class="chart-title" id="chart-symbol">QQQ</span>
                            <div style="font-size: 0.83rem; color:var(--text-dim);" id="chart-subtitle">INVESCO QQQ TRUST</div>
                        </div>
                        <div class="price-block">
                            <span class="current-price" id="current-price">$—</span>
                            <span class="price-change" id="price-change"></span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="metrics-grid" style="margin-top:0;">
                        <div class="metric-block">
                            <div class="metric-label">Confidence</div>
                            <div class="metric-value" id="confidence-value">—</div>
                        </div>
                        <div class="metric-block">
                            <div class="metric-label">Signal</div>
                            <div class="metric-value" id="signal-value">—</div>
                        </div>
                        <div class="metric-block">
                            <div class="metric-label">Accuracy</div>
                            <div class="metric-value" id="accuracy">—</div>
                        </div>
                        <div class="metric-block">
                            <div class="metric-label">Signals Today</div>
                            <div class="metric-value" id="signals-today">—</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Floating mobile action bar -->
    <div class="action-bar">
        <button class="action-btn" onclick="executeSignal()">Buy</button>
        <button class="action-btn" onclick="executeSignal()">Sell</button>
        <button class="action-btn" onclick="refreshData()">Refresh</button>
    </div>
    <!-- Scripts -->
    <script>
<script>
/* ===== HYPERtrends Neon - Chart + UI Logic ===== */

// ======= SYMBOL/DATA CONFIG =======
const symbolMeta = {
    QQQ: { name: "INVESCO QQQ TRUST", volume: "52.4M", cap: "$134.2B", beta: 1.18, volatility: "22.4%" },
    SPY: { name: "SPDR S&P 500 ETF", volume: "89.2M", cap: "$485.3B", beta: 1.00, volatility: "18.2%" },
    NVDA: { name: "NVIDIA CORPORATION", volume: "78.1M", cap: "$2.2T", beta: 1.64, volatility: "35.8%" },
    AAPL: { name: "APPLE INC", volume: "45.6M", cap: "$3.1T", beta: 1.25, volatility: "24.1%" },
    MSFT: { name: "MICROSOFT CORPORATION", volume: "32.8M", cap: "$3.4T", beta: 0.92, volatility: "21.3%" },
};
const symbols = Object.keys(symbolMeta);
const intervals = ["1m", "5m", "15m", "1h", "4h", "1d"];

// ======= GLOBAL STATE =======
let currentSymbol = "QQQ";
let currentInterval = "15m";
let chart = null;
let signals = {};  // e.g. { QQQ: [{ x, o, h, l, c, signal, confidence }, ...] }
let pricePoints = []; // Candlestick bars for current chart

// ======= INIT =======
document.addEventListener('DOMContentLoaded', () => {
    bindControls();
    updateMetaPanels();
    initChart();
    loadHistoryData(); // First load
});

// ======= UI EVENTS =======
function bindControls() {
    // Symbol switcher
    document.querySelectorAll('.symbol-btn').forEach(btn => {
        btn.addEventListener('click', e => {
            document.querySelectorAll('.symbol-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            currentSymbol = btn.dataset.symbol;
            updateMetaPanels();
            loadHistoryData();
        });
    });
    // Interval switcher
    document.querySelectorAll('.timeframe-btn').forEach(btn => {
        btn.addEventListener('click', e => {
            document.querySelectorAll('.timeframe-btn').forEach(b=>b.classList.remove('active'));
            btn.classList.add('active');
            currentInterval = btn.dataset.interval;
            loadHistoryData();
        });
    });
}

// ======= PANELS =======
function updateMetaPanels() {
    // Main meta
    const meta = symbolMeta[currentSymbol];
    document.getElementById('chart-symbol').textContent = currentSymbol;
    document.getElementById('chart-subtitle').textContent = meta.name;
    document.getElementById('daily-volume').textContent = meta.volume;
    document.getElementById('market-cap').textContent = meta.cap;
    document.getElementById('beta').textContent = meta.beta;
    document.getElementById('volatility').textContent = meta.volatility;
}

// ======= CHART =======
function initChart() {
    const ctx = document.getElementById('priceChart').getContext('2d');
    chart = new Chart(ctx, {
        type: 'candlestick',
        data: {
            datasets: [
                {
                    label: 'Price',
                    data: [],
                    borderColor: "#00fff7",
                    color: {
                        up: "#24ff87",
                        down: "#ff304c",
                        unchanged: "#fff800"
                    }
                },
                {
                    type: 'scatter',
                    label: 'Signals',
                    data: [],
                    pointStyle: ctx => ctx.raw.signal === "BUY" ? 'triangle' : 'rectRot',
                    backgroundColor: ctx => ctx.raw.signal === "BUY" ? "#24ff87" : "#ff304c",
                    pointRadius: 8,
                    showLine: false
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                x: { type: 'time', time: { unit: 'minute' }, ticks: { color: "#a2adb8" } },
                y: { ticks: { color: "#a2adb8" } }
            }
        }
    });
}

// ======= DATA LOAD & PLOTTING =======
async function loadHistoryData() {
    // Try to load real data from API, else show demo
    try {
        const url = `/api/history?symbol=${currentSymbol}&interval=${currentInterval}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("API unavailable");
        const hist = await res.json();
        plotCandles(hist.history);
        plotSignals(hist.history);
        updatePricePanels(hist.history);
    } catch {
        // Demo/fallback data for offline or no API
        const demo = genDemoCandles();
        plotCandles(demo);
        plotSignals(demo);
        updatePricePanels(demo);
    }
}

function plotCandles(candles) {
    chart.data.datasets[0].data = candles.map(d=>({
        x: d.timestamp,
        o: d.open, h: d.high, l: d.low, c: d.close
    }));
    chart.update();
}

function plotSignals(candles) {
    chart.data.datasets[1].data = candles.filter(d=>d.signal).map(d=>({
        x: d.timestamp,
        y: d.close,
        signal: d.signal,
        confidence: d.confidence
    }));
    chart.update();
}

function updatePricePanels(candles) {
    if (!candles.length) return;
    const last = candles[candles.length-1];
    document.getElementById('current-price').textContent = "$" + last.close.toFixed(2);
    const prev = candles[candles.length-2] || last;
    const chg = last.close - prev.close;
    const chgPct = prev.close ? (chg/prev.close)*100 : 0;
    const el = document.getElementById('price-change');
    el.textContent = `${chg>=0?"+":""}${chg.toFixed(2)} (${chgPct>=0?"+":""}${chgPct.toFixed(2)}%)`;
    el.className = "price-change " + (chg>=0?"price-up":"price-down");

    // Panels: confidence, signal, etc (simulate for demo)
    document.getElementById('confidence-value').textContent = last.confidence ? last.confidence+"%" : "81%";
    document.getElementById('signal-value').textContent = last.signal ? last.signal : "HOLD";
    document.getElementById('accuracy').textContent = "77%";
    document.getElementById('signals-today').textContent = "41";
}

// ======= DEMO CANDLE GEN (offline fallback) =======
function genDemoCandles() {
    const bars = [];
    const now = Date.now();
    let price = 435 + Math.random()*20;
    for (let i = 59; i >= 0; i--) {
        const t = new Date(now - i * 60*1000);
        const o = price;
        const chg = (Math.random()-0.5)*2.5;
        price = o + chg;
        const h = Math.max(o, price) + Math.random();
        const l = Math.min(o, price) - Math.random();
        const c = price;
        // Add a random signal (1 in 20 bars)
        let signal = undefined, confidence = undefined;
        if (Math.random() < 0.06) {
            signal = (Math.random() < 0.5) ? "BUY" : "SELL";
            confidence = Math.round(75 + Math.random()*23);
        }
        bars.push({timestamp: t, open:o, high:h, low:l, close:c, signal, confidence});
    }
    return bars;
}

// ======= MOBILE ACTIONS =======
function executeSignal() {
    alert("Action executed (sim/demo)!");
}
function refreshData() {
    loadHistoryData();
}
</script>
    </script>
</body>
</html>
